package JavaKaja.runtime;

/*Generated by MPS */

import java.util.List;
import java.util.Random;
import java.awt.Color;

public class TrafficLightCell extends RoadCell {
  private int ticks;
  private final int ticksToChange;
  private int currentColourIndex;
  private List<Colour> colours;
  private static final double PASS_YELLOW_PROB = 2;
  private static final Random random = new Random();

  public TrafficLightCell(int ticksToChange, List<Colour> colours, Direction... directions) {
    super(directions);
    this.colours = colours;
    this.ticks = 0;
    this.ticksToChange = ticksToChange;
    this.currentColourIndex = 0;
  }

  public void tick() {
    this.ticks++;
    if (ticks % ticksToChange == 0) {
      currentColourIndex++;
      if (currentColourIndex >= colours.size()) {
        currentColourIndex = 0;
      }
    }
  }

  @Override
  public boolean isDrivable(Direction direction) {
    if (colours.get(currentColourIndex) == Colour.RED) {
      return false;
    } else if (colours.get(currentColourIndex) == Colour.YELLOW) {
      // return true or false at random as the car is at a yellow light 
      if (random.nextInt(11) < PASS_YELLOW_PROB) {
        return true;
      } else {
        return false;
      }

    } else {
      return super.isDrivable(direction);
    }
  }


  @Override
  public Color getColor() {
    return colours.get(currentColourIndex).getColor();
  }
}
